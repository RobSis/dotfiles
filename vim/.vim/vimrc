" vim-plug
call plug#begin('~/.vim/vim-plugs')
Plug 'junegunn/goyo.vim'
Plug 'junegunn/fzf', { 'dir': '~/.fzf', 'do': './install --all' }
Plug 'junegunn/fzf.vim'
Plug 'vim-airline/vim-airline'
Plug 'vim-airline/vim-airline-themes'
Plug 'roxma/vim-tmux-clipboard'
Plug 'tpope/vim-fugitive'
call plug#end()

" look & feel
syntax on
set background=dark
set number
set relativenumber
set autoindent smartindent
set listchars=tab:▸\ ,trail:·
set list
set shortmess+=I

" tabs
set tabstop=4
set softtabstop=4
set shiftwidth=4
set expandtab

" statusline
set laststatus=2
set noshowmode

set ignorecase
set smartcase
set incsearch
set hlsearch
set showmatch

"set clipboard=unnamed,unnamedplus
" Work-around for tmux+vim slow-start problem (vim 8.??)
" Run with vim -X and uncomment this line:
autocmd TextYankPost * call system('xclip -sel primary', @0)

" mouse support
set mouse=a

set tags+=.git/tags

colorscheme darcula
if &diff
    colorscheme vimdiff
endif

let g:airline_theme='minimalist'
let g:airline_powerline_fonts = 1

function! s:goyo_enter()
    set showmode
endfunction
autocmd! User GoyoEnter call <SID>goyo_enter()

command! Hi80 highlight OverLength ctermbg=red ctermfg=white guibg=#592929 | match OverLength /\%81v.\+/

" Sort words on line
command -nargs=0 -range SortLine <line1>,<line2>call setline('.',join(sort(split(getline('.'),' ')),' '))

if has('autocmd')
  fun! <SID>StripTrailingWhitespaces()
      let l = line(".")
      let c = col(".")
      %s/\s\+$//e
      call cursor(l, c)
  endfun

  filetype plugin indent on
  au BufNewFile,BufRead *.ftl set syntax=xml
  au BufNewFile,BufRead *.html set syntax=xml
  au BufNewFile,BufRead *.py,*.sh Hi80
  au BufWritePre * call <SID>StripTrailingWhitespaces()

  autocmd BufWritePost *
    \ if filereadable('tags') |
    \   call system('ctags -a '.expand('%')) |
    \ endif
endif

" Seamless integration with tmux-splits.
function! TmuxMove(direction)
        let wnr = winnr()
        silent! execute 'wincmd ' . a:direction
        " If the winnr is still the same after we moved, it is the last pane
        if wnr == winnr()
                call system('tmux select-pane -' . tr(a:direction, 'phjkl', 'lLDUR'))
        end
endfunction
nnoremap <silent> <c-w>h :call TmuxMove('h')<cr>
nnoremap <silent> <c-w>j :call TmuxMove('j')<cr>
nnoremap <silent> <c-w>k :call TmuxMove('k')<cr>
nnoremap <silent> <c-w>l :call TmuxMove('l')<cr>

set timeoutlen=50 ttimeoutlen=0
" modern backspace & delete
set backspace=indent,eol,start

" more readline-like kill word
inoremap <C-w> <C-\><C-o>dB
inoremap <C-BS> <C-\><C-o>db

set pastetoggle=<F2>

nmap ZA :qall!<CR>

" Allow saving of files as sudo when I forgot to start vim using sudo.
cmap w!! w !sudo tee > /dev/null %

map <c-t> :FZF<cr>
